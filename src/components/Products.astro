---
import { Image } from "astro:assets";
import { getLangFromUrl } from "../i18n/utils";
import { ui } from "../i18n/ui";

// Import product images - mapped by slug
import shotBlastingMachine from "../assets/products/shot_blasting_machine.jpeg";
import pipesShotBlasting from "../assets/products/pipes_shot_blasting.jpeg";
import rollerConveyorShotBlasting from "../assets/products/roller_conveyor_shot_blasting.jpg";
import powderCoatingBooth from "../assets/products/powder_coating.jpeg";
import sprayBooth from "../assets/products/spray_booth.jpeg";
import tunnelTypeShotBlasting from "../assets/products/tunnel_type_shot_blasting.jpg";

const lang = getLangFromUrl(Astro.url);
const t = ui[lang];

// Map images by product slug for CMS compatibility
const imagesBySlug: Record<string, ImageMetadata> = {
  "shot-blasting-machine": shotBlastingMachine,
  "pipes-shot-blasting": pipesShotBlasting,
  "roller-conveyor-shot-blasting": rollerConveyorShotBlasting,
  "powder-coating-booth": powderCoatingBooth,
  "spray-booth": sprayBooth,
  "tunnel-type-shot-blasting": tunnelTypeShotBlasting,
};

// Default/placeholder image for products without a mapped image
const defaultImage = shotBlastingMachine;

// Get image for a product, with fallback
function getProductImage(slug: string): ImageMetadata {
  return imagesBySlug[slug] || defaultImage;
}
---

<section class="bg-[var(--products-section-bg)] py-20">
  <div class="container mx-auto px-4">
    <h2
      class="text-4xl font-serif font-bold text-center mb-12 text-[var(--products-section-title)]"
    >
      {t.productsSection.title}
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {
        t.productsSection.items.map((item) => (
          <div class="bg-[var(--products-card-bg)] rounded-lg shadow-lg overflow-hidden flex flex-col h-full transition-transform hover:-translate-y-2">
            <a
              href={`/${lang}/products/${item.slug}`}
              class="block flex-shrink-0"
            >
              <Image
                src={getProductImage(item.slug)}
                alt={item.title}
                width={400}
                height={306}
                class="w-full h-[306px] object-cover"
              />
            </a>
            <div class="p-6 flex flex-col flex-grow">
              <h3 class="text-xl font-bold text-[var(--products-card-title)] mb-2">
                {item.title}
              </h3>
              <p class="text-[var(--products-card-description)] mb-6 flex-grow">
                {item.description}
              </p>
              <a
                href={`/${lang}/products/${item.slug}`}
                class="inline-block text-[var(--accent)] font-bold hover:underline"
              >
                {lang === "pl" ? "Zobacz szczegóły" : "View details"} &rarr;
              </a>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
