---
import Layout from "./Layout.astro";
import { getLangFromUrl } from "../i18n/utils";
import { ui } from "../i18n/ui";

interface Props {
    product: {
        title: string;
        description: string;
        details: {
            fullDescription: string;
            specifications: { label: string; value: string }[];
        };
    };
    mainImage: string;
    gallery: string[];
}

const { product, mainImage, gallery } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = ui[lang];
---

<Layout title={product.title}>
    <section class="pt-32 pb-20 bg-[var(--product-detail-bg)]">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap -mx-4">
                <!-- Product Images -->
                <div class="w-full lg:w-1/2 px-4 mb-12 lg:mb-0">
                    <div
                        class="bg-[var(--product-detail-card-bg)] rounded-2xl overflow-hidden shadow-2xl mb-6"
                    >
                        <img
                            id="main-product-image"
                            src={mainImage}
                            alt={product.title}
                            class="w-full h-[500px] object-cover transition-opacity duration-300"
                            loading="lazy"
                        />
                    </div>
                    <div class="grid grid-cols-4 gap-4">
                        {
                            gallery.map((img, index) => (
                                <div class="gallery-thumbnail-container bg-[var(--product-detail-card-bg)] rounded-lg overflow-hidden shadow-md cursor-pointer hover:opacity-80 transition-all border-2 border-transparent">
                                    <img
                                        src={img}
                                        alt={`${product.title} gallery ${index + 1}`}
                                        class="gallery-thumbnail w-full h-24 object-cover"
                                        loading="lazy"
                                    />
                                </div>
                            ))
                        }
                    </div>
                </div>

                <!-- Product Info -->
                <div class="w-full lg:w-1/2 px-4">
                    <div class="lg:pl-8">
                        <h1
                            class="text-4xl lg:text-5xl font-serif font-bold text-[var(--product-detail-title)] mb-6"
                        >
                            {product.title}
                        </h1>
                        <p
                            class="text-xl text-[var(--product-detail-description)] font-medium mb-8"
                        >
                            {product.description}
                        </p>

                        <div
                            class="prose prose-lg text-[var(--product-detail-text)] mb-12"
                        >
                            <p>{product.details.fullDescription}</p>
                        </div>

                        <div
                            class="bg-[var(--product-detail-card-bg)] rounded-xl p-8 shadow-lg border border-[var(--product-detail-border)]"
                        >
                            <h2
                                class="text-2xl font-bold text-[var(--product-detail-title)] mb-6"
                            >
                                {
                                    lang === "pl"
                                        ? "Specyfikacja techniczna"
                                        : "Technical Specifications"
                                }
                            </h2>
                            <dl class="space-y-4">
                                {
                                    product.details.specifications.map(
                                        (spec) => (
                                            <div class="flex border-b border-[var(--product-detail-border)] pb-3 last:border-0 last:pb-0">
                                                <dt class="w-1/3 font-semibold text-[var(--product-detail-title)]">
                                                    {spec.label}
                                                </dt>
                                                <dd class="w-2/3 text-[var(--product-detail-text)]">
                                                    {spec.value}
                                                </dd>
                                            </div>
                                        ),
                                    )
                                }
                            </dl>
                        </div>

                        <div class="mt-12">
                            <a
                                href={`/${lang}/#contact`}
                                class="inline-block bg-[var(--product-detail-button-bg)] text-[var(--product-detail-button-text)] font-bold py-4 px-10 rounded-full shadow-lg hover:bg-[var(--product-detail-button-hover-bg)] transition-all transform hover:-translate-y-1"
                            >
                                {
                                    lang === "pl"
                                        ? "Zapytaj o produkt"
                                        : "Inquire about product"
                                }
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</Layout>

<script>
    function initGallery() {
        const mainImage = document.getElementById(
            "main-product-image",
        ) as HTMLImageElement;
        const thumbnails = document.querySelectorAll(
            ".gallery-thumbnail-container",
        );

        if (!mainImage || thumbnails.length === 0) return;

        // Set first thumbnail as active initially
        thumbnails[0].classList.add("border-[var(--accent)]");

        thumbnails.forEach((container) => {
            container.addEventListener("click", () => {
                const img = container.querySelector(
                    ".gallery-thumbnail",
                ) as HTMLImageElement;
                if (!img || !mainImage) return;

                // Update active state
                thumbnails.forEach((t) =>
                    t.classList.remove("border-[var(--accent)]"),
                );
                container.classList.add("border-[var(--accent)]");

                // Fade out, change src, fade in
                mainImage.style.opacity = "0";
                setTimeout(() => {
                    mainImage.src = img.src;
                    mainImage.alt = img.alt;
                    mainImage.style.opacity = "1";
                }, 150);
            });
        });
    }

    // Initialize on page load
    initGallery();

    // Re-initialize after view transitions
    document.addEventListener("astro:after-swap", initGallery);
</script>

<style>
    .prose p {
        line-height: 1.8;
    }
</style>
