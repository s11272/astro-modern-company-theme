---
// No server-side logic - all handled client-side
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Blastserv</title>
        <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"
        ></script>
    </head>
    <body>
        <p
            id="status"
            style="text-align: center; margin-top: 50px; font-family: sans-serif;"
        >
            Loading...
        </p>

        <script is:inline>
            // Check for Netlify Identity tokens in URL hash
            var hash = window.location.hash || "";
            var hasToken =
                hash.indexOf("invite_token") !== -1 ||
                hash.indexOf("confirmation_token") !== -1 ||
                hash.indexOf("recovery_token") !== -1;

            if (hasToken) {
                document.getElementById("status").textContent =
                    "Setting up your account...";

                // Wait for widget to load
                function waitForIdentity() {
                    if (window.netlifyIdentity) {
                        // Set up login handler
                        window.netlifyIdentity.on("login", function () {
                            window.location.href = "/admin/";
                        });

                        // Open the modal - widget will auto-detect token from URL
                        window.netlifyIdentity.open();
                    } else {
                        setTimeout(waitForIdentity, 100);
                    }
                }
                waitForIdentity();
            } else {
                // No token - redirect to Polish homepage
                window.location.replace("/pl/");
            }
        </script>
    </body>
</html>
